<local:WidgetWindowBase
    x:Class="_3SC.Widgets.Breathe.BreatheWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:_3SC.Widgets.Breathe"
    Title="Breathe"
    Width="220"
    Height="280"
    WindowStyle="None"
    AllowsTransparency="True"
    Background="Transparent"
    ShowInTaskbar="False"
    ResizeMode="CanResizeWithGrip">

    <local:WidgetWindowBase.Resources>
        <SolidColorBrush x:Key="TextPrimary"
                Color="#FFF7FAFC"/>
        <SolidColorBrush x:Key="TextSecondary"
                Color="#FFA0AEC0"/>
        <SolidColorBrush x:Key="BorderColor"
                Color="#30FFFFFF"/>
    </local:WidgetWindowBase.Resources>

    <Border Background="{Binding BackgroundBrush}"
            BorderBrush="{StaticResource BorderColor}"
            BorderThickness="1"
            CornerRadius="20"
            MouseLeftButtonDown="Border_MouseLeftButtonDown">
        <Border.Effect>
            <DropShadowEffect Color="Black"
                    BlurRadius="30"
                    ShadowDepth="0"
                    Opacity="0.7"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Pattern Name -->
            <Button Grid.Row="0"
                    HorizontalAlignment="Center"
                    Margin="0,16,0,0"
                    Command="{Binding NextPatternCommand}"
                    Cursor="Hand">
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding SelectedPattern.Name}"
                                    FontSize="14"
                                    FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimary}"/>
                            <TextBlock Text=" â–¼"
                                    FontSize="10"
                                    Foreground="{StaticResource TextSecondary}"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </ControlTemplate>
                </Button.Template>
            </Button>

            <!-- Breathing Circle -->
            <Grid Grid.Row="1"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                <!-- Outer rotating ring -->
                <Ellipse Width="140"
                        Height="140"
                        StrokeThickness="2"
                         Stroke="{StaticResource BorderColor}"
                         StrokeDashArray="4 2"
                         RenderTransformOrigin="0.5,0.5">
                    <Ellipse.RenderTransform>
                        <RotateTransform Angle="{Binding RingRotation}"/>
                    </Ellipse.RenderTransform>
                </Ellipse>

                <!-- Main breathing circle -->
                <Ellipse Width="120"
                        Height="120"
                         Fill="{Binding CircleBrush}"
                         Opacity="{Binding CircleOpacity}"
                         RenderTransformOrigin="0.5,0.5">
                    <Ellipse.Effect>
                        <BlurEffect Radius="10"/>
                    </Ellipse.Effect>
                    <Ellipse.RenderTransform>
                        <ScaleTransform ScaleX="{Binding CircleScale}"
                                ScaleY="{Binding CircleScale}"/>
                    </Ellipse.RenderTransform>
                </Ellipse>

                <!-- Inner circle -->
                <Ellipse Width="100"
                        Height="100"
                         Fill="{Binding CircleBrush}"
                         Opacity="0.8"
                         RenderTransformOrigin="0.5,0.5">
                    <Ellipse.RenderTransform>
                        <ScaleTransform ScaleX="{Binding CircleScale}"
                                ScaleY="{Binding CircleScale}"/>
                    </Ellipse.RenderTransform>
                </Ellipse>

                <!-- Center content -->
                <StackPanel HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                            RenderTransformOrigin="0.5,0.5">
                    <StackPanel.RenderTransform>
                        <ScaleTransform ScaleX="{Binding CircleScale}"
                                ScaleY="{Binding CircleScale}"/>
                    </StackPanel.RenderTransform>

                    <TextBlock Text="{Binding TimerText}"
                            FontSize="28"
                            FontWeight="Light"
                               Foreground="{StaticResource TextPrimary}"
                               HorizontalAlignment="Center"/>
                </StackPanel>

                <!-- Clickable overlay -->
                <Ellipse Width="140"
                        Height="140"
                        Fill="Transparent"
                        Cursor="Hand"
                         MouseLeftButtonUp="Circle_Click"/>
            </Grid>

            <!-- Phase Text -->
            <StackPanel Grid.Row="2"
                    HorizontalAlignment="Center"
                    Margin="0,0,0,8">
                <TextBlock Text="{Binding PhaseText}"
                        FontSize="16"
                        FontWeight="Medium"
                           Foreground="{StaticResource TextPrimary}"
                           HorizontalAlignment="Center"/>
                <TextBlock Text="{Binding SelectedPattern.Description}"
                        FontSize="10"
                           Foreground="{StaticResource TextSecondary}"
                           HorizontalAlignment="Center"
                        Margin="0,4,0,0"
                           TextWrapping="Wrap"
                        TextAlignment="Center"
                        MaxWidth="180"/>
            </StackPanel>

            <!-- Cycles Counter -->
            <StackPanel Grid.Row="3"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Margin="0,0,0,16">
                <TextBlock Text="Cycles: "
                        FontSize="11"
                        Foreground="{StaticResource TextSecondary}"/>
                <TextBlock Text="{Binding CompletedCycles}"
                        FontSize="11"
                        FontWeight="SemiBold"
                           Foreground="{StaticResource TextPrimary}"/>
            </StackPanel>
        </Grid>
    </Border>
</local:WidgetWindowBase>
